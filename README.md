 Техническая документация проекта Telegram Case Bot

1. Введение

1.1 Описание проекта

Telegram Case Bot — бот в Telegram для загрузки политических кейсов в формате PDF, анализа через OpenAI и возвращения рекомендаций пользователю.

1.2 Основные функции

	•	Интерфейс с кнопками: Использование кнопок для удобного взаимодействия с ботом.
	•	Пользовательское соглашение: Обязательное согласие перед загрузкой кейсов.
	•	Загрузка кейсов: Поддержка загрузки PDF-файлов с политическими кейсами.
	•	Анализ кейсов: Использование OpenAI API для анализа и выявления несостыковок в кейсах.
	•	Генерация отчетов: Создание PDF-отчетов с результатами анализа.
	•	Ошибки и уведомления: Обработка и уведомление об ошибках, включая опцию связи с поддержкой.
	•	Логирование: Логирование технических ошибок и процессов для отслеживания состояния бота.

2. Архитектура проекта

telegram_case_bot/
│
├── bot.py                     # Основной файл запуска бота и логика взаимодействия с пользователями
├── config.py                  # Конфигурации и ключи API
├── pdf_processing.py          # Модуль для обработки и извлечения текста из PDF
├── openai_api.py              # Модуль для связи с OpenAI API
├── report_generator.py        # Генерация отчета в формате PDF
├── logging_config.py          # Настройка логирования для технических ошибок
│
├── data/
│   └── templates/             # Шаблоны для PDF-отчета (если нужно)
│
└── logs/                      # Папка для логов ошибок и технических данных

2.1 Общая структура

bot.py
Основной модуль, отвечающий за взаимодействие с Telegram API. Реализует логику пользовательского интерфейса, включая кнопки, получение PDF-файлов от пользователей и отправку уведомлений об ошибках. Взаимодействует с модулями для обработки PDF-документов, работы с OpenAI API, генерации отчетов и логирования событий и ошибок.

config.py
Файл конфигурации, в котором хранятся токены и ключи API, такие как Telegram Bot Token, OpenAI API Key и параметры для шифрования. Обеспечивает доступ к данным конфигурации для всех модулей.

pdf_processing.py
Содержит функции для обработки загруженных PDF-файлов, включая извлечение текста для дальнейшего анализа. Использует библиотеки, такие как PyMuPDF или pdfplumber, для обработки PDF-документов.

openai_api.py
Модуль для формирования и отправки запросов к OpenAI API. Обрабатывает ответы от OpenAI и подготавливает их для использования в других модулях, таких как генерация отчетов.

report_generator.py
Создает PDF-отчеты для пользователей на основе данных, полученных от OpenAI. Использует библиотеку reportlab для генерации PDF-документов.

logging_config.py
Конфигурирует логирование, чтобы сохранять технические ошибки и события в лог-файлы без конфиденциальных данных. Настроено на запись логов в файл logs/bot_errors.log, что упрощает отслеживание ошибок.

data/templates/
Папка для хранения шаблонов и данных, необходимых для создания отчетов в формате PDF, если требуется специфическое форматирование.

logs/
Папка для хранения логов технических ошибок и событий, что позволяет удобно управлять и анализировать журналы.

2.2 Основные модули

	•	bot.py: Основной файл, управляющий логикой бота и взаимодействием с пользователем.
	•	pdf_processing.py: Модуль для обработки PDF-файлов и извлечения текста.
	•	openai_api.py: Модуль для обращения к API OpenAI.
	•	report_generator.py: Модуль для генерации отчетов в формате PDF.
	•	logging_config.py: Настройка и конфигурация логирования ошибок и технических событий.

2.3 Поток взаимодействия

	1.	Пользователь принимает соглашение.
	2.	Загружает PDF-файл.
	3.	Бот обрабатывает PDF-файл с помощью Pdfplumber, шифрует данные и отправляет текст в OpenAI.
	4.	Бот получает результаты, создаёт отчет (PDF) с помощью reportlab и отправляет пользователю.
	5.	В случае ошибки — уведомление пользователю и владельцу и логирование для владельца.

Раздел 2.4: Поток обработки данных и запросов

	•	Инициализация и безопасное соединение
Бот запускается с использованием python-telegram-bot, обеспечивая взаимодействие с Telegram API через SSL/TLS. Это защищает передаваемые данные от перехвата.
	•	Загрузка и обработка PDF-файла
После загрузки пользователем PDF-файла бот использует pdf_processing.py и библиотеку Pdfplumber для извлечения текста, который затем подготавливается для отправки в OpenAI.
	•	Шифрование данных
Данные шифруются с помощью библиотеки cryptography, чтобы сохранить конфиденциальность на этапе передачи.
	•	Запрос к OpenAI и обработка ответа
Отправка текста в OpenAI происходит через openai_api.py. Запрос включает параметры, такие как используемая модель, ограничение на длину ответа и другие настройки. Бот получает и обрабатывает ответ для подготовки отчета.
	•	Генерация отчета
Бот использует report_generator.py и reportlab для создания PDF-отчета на основе данных OpenAI. Отчет содержит основные выводы и рекомендации.
	•	Логирование взаимодействий и событий
На каждом этапе выполнения операций ведется логирование через logging_config.py. Логи сохраняются в /logs, что облегчает диагностику ошибок и анализ работы бота.


3. Используемые технологии




3.1 Язык программирования

	•	Python 3.10

3.2 Библиотеки и зависимости

• python-telegram-bot: Взаимодействие с Telegram API с использованием защищенного соединения SSL/TLS для безопасного обмена данными.
• openai: Подключение к OpenAI API, настройка параметров запросов (модель, длина ответа) для анализа текста.
• Pdfplumber: Извлечение текста из PDF-файлов, поддержка крупномасштабной обработки текстовых данных из файлов.
• reportlab: Генерация PDF-отчетов с возможностью настройки визуальных элементов и структуры отчета.
• cryptography: Шифрование данных перед отправкой в OpenAI, поддержка AES для повышения безопасности передачи.
• logging: Стандартное логирование в Python для сохранения информации о событиях, ошибках и отладке.


3.3 Среда развертывания

	•	SSL/TLS для защиты данных.

4. Установка и настройка

4.1 Требования

	•	Python 3.10
	•	Аккаунт и API ключи для Telegram и OpenAI

4.2 Установка

4.3 Конфигурация

Для корректной работы Telegram Case Bot требуется настроить файл config.py, в котором будут храниться все необходимые параметры конфигурации. Файл config.py содержит ключи API, настройки шифрования и другие параметры, необходимые для работы бота. Описание основных конфигураций:

	•	TELEGRAM_BOT_TOKEN: Токен, полученный при создании бота в Telegram. Этот токен позволяет боту подключаться к Telegram API и обрабатывать сообщения пользователей.
	•	OPENAI_API_KEY: Ключ API для доступа к OpenAI. Он используется для отправки запросов на анализ данных, извлечённых из загруженных PDF-файлов, и получения ответов от модели.
	•	ENCRYPTION_KEY: Ключ для шифрования данных перед передачей в OpenAI API. Для этого используется библиотека cryptography. Ключ шифрования обеспечивает безопасность конфиденциальных данных при их обработке.
	•	LOGGING_LEVEL: Уровень логирования, который задаёт уровень детализации информации, записываемой в лог-файлы. Возможные уровни включают DEBUG, INFO, WARNING, ERROR, и CRITICAL. Рекомендуется устанавливать INFO для рабочих версий и DEBUG для отладки.
	•	PDF_PROCESSING_SETTINGS: Параметры для модуля обработки PDF-файлов. Могут включать настройки по размерам загружаемых файлов, форматам, и методам извлечения текста.
	•	REPORT_TEMPLATE_PATH: Путь к шаблону отчета в формате PDF, который будет использоваться для создания отчетов. Этот параметр позволяет указать конкретный шаблон для улучшения унификации отчетов.

Файл config.py должен быть защищён и не должен быть доступен для посторонних, так как содержит конфиденциальные данные, включая API-ключи.

5. Безопасность

5.1 Шифрование данных

	•	Описание, как данные шифруются перед передачей в OpenAI.

5.2 Логирование без конфиденциальной информации

	•	Описание логики логирования только технической информации без хранения конфиденциальных данных.

6. Обработка ошибок и уведомления

6.1 Логирование ошибок

	•	Подробности о конфигурации logging_config.py, хранимых логах и обрабатываемых событиях.

6.2 Уведомления об ошибках

	•	Как пользователи информируются об ошибках.
	•	Процедура связи с поддержкой.

6.3 Логирование запросов и уведомление об ошибках

	•	Логирование API-запросов
Логируются запросы к OpenAI и их результаты, чтобы можно было отслеживать историю обращений и поведение бота.
	•	Уведомление об ошибках
В случае сбоя при обращении к OpenAI (например, превышение лимита запросов) бот отправляет уведомление пользователю и записывает ошибку в лог-файл, что помогает диагностировать проблемы.


7. Генерация отчетов

7.1 Структура PDF-отчета

	•	Состав и структура отчетов, генерируемых report_generator.py.

7.2 Пример отчета

Описание и пример содержания отчета, который пользователь получит.

8. Поддержка и отладка

8.1 Частые ошибки

	•	Описание распространенных ошибок и методов их устранения.

8.2 Контакты для поддержки

	•	Информация о канале или способах связи для обращения в случае проблем.

9. Лицензия

Описание лицензии, если проект доступен публично.

Этот шаблон охватывает все ключевые аспекты проекта, которые легко дополнить в других чатах. Удачи в разработке!
